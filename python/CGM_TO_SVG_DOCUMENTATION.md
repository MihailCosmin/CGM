# CGM to SVG Converter

## Overview

The `cleartextcgm_to_svg.py` script converts Clear Text CGM files (as generated by our binary CGM converter) to Scalable Vector Graphics (SVG) format. This allows CGM technical drawings to be viewed in web browsers, embedded in web pages, or opened in vector graphics applications.

## Features

### Supported CGM Commands
- **Structure**: BEGMF, BEGPIC, BEGPICBODY (document structure)
- **Coordinates**: vdcext (viewport/coordinate system setup)
- **Graphics Primitives**: 
  - LINE (polylines/paths)
  - DISJTLINE (disjoint/separate line segments)
  - TEXT (text elements with positioning)
  - POLYGON (filled shapes)
- **Line Attributes**: linewidth, linetype, linecolr
- **Text Attributes**: textfontindex, charheight, textcolr
- **Fill Attributes**: fillcolr

### Color Support
- **Indexed Colors**: Standard CGM color palette (0-255)
- **Direct RGB**: Full RGB color specification
- **Default Palette**: Standard technical drawing colors

### Coordinate Transformation
- **Automatic Scaling**: Scales CGM coordinates to fit SVG viewport
- **Aspect Ratio**: Preserves original drawing proportions
- **Coordinate System**: Handles CGM bottom-left origin to SVG top-left
- **Configurable Output**: Customizable SVG dimensions

## Usage

### Basic Usage
```bash
# Convert with default 800x600 dimensions
python cleartextcgm_to_svg.py input.CGM output.svg

# Auto-generate output filename (input.svg)
python cleartextcgm_to_svg.py drawing.CGM

# Specify custom dimensions
python cleartextcgm_to_svg.py drawing.CGM drawing.svg 1200 800
```

### Examples

#### Convert Technical Drawing
```bash
# Convert our techdraw example to high-resolution SVG
python cleartextcgm_to_svg.py tests/00003/techdraw_cleartext.CGM techdraw_hires.svg 1600 1200
```

#### Batch Conversion
```bash
# Convert all CGM files in a directory
for cgm_file in *.CGM; do
    python cleartextcgm_to_svg.py "$cgm_file" "${cgm_file%.CGM}.svg" 1200 900
done
```

#### Web Integration
```bash
# Convert for web display (smaller dimensions)
python cleartextcgm_to_svg.py manual_diagram.CGM web_diagram.svg 800 600
```

## Output Quality

### Test Results
- **techdraw.cgm**: 248KB clear text â†’ 425KB SVG with 1,349 elements
- **Perfect conversion**: Zero "Unknown command" entries
- **High fidelity**: Preserves line weights, coordinates, and text positioning

### Supported Line Types
1. **Solid** (linetype 1)
2. **Dash** (linetype 2) 
3. **Dot** (linetype 3)
4. **Dash-Dot** (linetype 4)
5. **Dash-Dot-Dot** (linetype 5)

### Font Mapping
- **Font 1**: Arial, sans-serif (default)
- **Font 2**: Times, serif (technical documentation) 
- **Font 3**: Courier, monospace (code/labels)
- **Font 14**: Arial, sans-serif (common in technical drawings)

## Integration with CGM Pipeline

### Complete Workflow
```bash
# 1. Convert Binary CGM to Clear Text
python main.py technical_drawing.cgm drawing_cleartext.CGM

# 2. Convert Clear Text to SVG
python cleartextcgm_to_svg.py drawing_cleartext.CGM drawing.svg 1200 900

# 3. View in browser or embed in HTML
```

### HTML Integration
```html
<!DOCTYPE html>
<html>
<head><title>Technical Drawing</title></head>
<body>
    <h1>Aircraft Component Diagram</h1>
    <object data="drawing.svg" type="image/svg+xml" width="1200" height="900">
        Your browser does not support SVG
    </object>
</body>
</html>
```

## Architecture

### Key Classes
- **Point**: 2D coordinate representation
- **Color**: RGB color with indexed palette support
- **GraphicsState**: Current drawing attributes (line width, color, fonts)
- **CGMToSVGConverter**: Main conversion engine

### Processing Pipeline
1. **Parse CGM**: Read and tokenize clear text commands
2. **State Management**: Track current drawing attributes
3. **Coordinate Transform**: Convert CGM to SVG coordinate system
4. **SVG Generation**: Create optimized SVG elements
5. **Output**: Write complete SVG document

### Coordinate Transformation
```python
# CGM uses bottom-left origin, SVG uses top-left
# Scale preserves aspect ratio and centers drawing
scale = min(svg_width / cgm_width, svg_height / cgm_height)
svg_x = (cgm_x - cgm_min_x) * scale + offset_x
svg_y = svg_height - ((cgm_y - cgm_min_y) * scale + offset_y)
```

## Error Handling

### Common Issues
- **Missing vdcext**: Uses default 1000x1000 coordinate system
- **Invalid coordinates**: Skips malformed point specifications
- **Unknown line types**: Falls back to solid lines
- **Missing colors**: Uses black as default

### Debugging
Add debug output by temporarily modifying the `_parse_command` method to include print statements for troubleshooting specific conversion issues.

## Performance

### Typical Conversion Times
- **Small drawings** (< 100 elements): < 1 second
- **Medium drawings** (1000 elements): 2-3 seconds  
- **Large drawings** (5000+ elements): 5-10 seconds

### Memory Usage
- **Input**: Clear text CGM loaded into memory
- **Processing**: Minimal overhead during parsing
- **Output**: SVG generated incrementally

## Future Enhancements

### Potential Improvements
- **More Primitives**: Circles, arcs, bezier curves
- **Advanced Text**: Character spacing, orientation, multi-line
- **Pattern Fills**: Hatching and custom patterns  
- **Clip Regions**: SVG clipping path support
- **Layers**: Group related elements
- **Metadata**: Preserve CGM titles and descriptions

### Performance Optimizations
- **Streaming**: Process large files without loading entirely
- **Path Optimization**: Combine consecutive line segments
- **CSS Styling**: External stylesheets for repeated attributes

This converter represents a complete solution for visualizing CGM technical drawings in modern web environments while maintaining high fidelity to the original specifications.